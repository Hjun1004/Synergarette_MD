<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>송금 안내</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 2em; }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 10px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h2>송금하실 은행을 선택하세요</h2>

    <!-- <a href="shinhan-sbank://" class="btn">신한은행으로 송금하기</a><br> -->
    <button class="btn" id="open-sol-btn">신한 SOL 실행하기</button><br>
    <a href="#" onclick="appLink(); return false;"  class="btn">국민은행으로 송금하기</a><br>
    <a href="toss://send?accountNo=12345678901234&bankCode=88" class="btn">토스로 송금하기</a>

    <script>
        function appLink() {
            var locIOS     = "kbbank://call?";
            var locAndroid = "intent://call?#Intent;scheme=kbbank;action=android.intent.action.VIEW;category=android.intent.category.BROWSABLE;package=com.kbstar.kbbank;end";
            var userAgent  = navigator.userAgent.toLowerCase();
        
            var delfinoYn = /Delfino-/i;
        
            if (userAgent.match(/iphone/) && !userAgent.match(delfinoYn)) {
                setTimeout(function() {
                    location.href = "https://itunes.apple.com/kr/app/kbseutabaengking/id373742138?mt=8";
                }, 1500);
                location.href = locIOS;
                return;
            } else if (userAgent.match(/android/) && !userAgent.match(delfinoYn)) {
                var androidStoreUrl = "https://play.google.com/store/apps/details?id=com.kbstar.kbbank";
        
                if (userAgent.match(/chrome/)) {
                    location.href = locAndroid;
                } else {
                    setTimeout(function() {
                        location.href = androidStoreUrl;
                    }, 1500);
        
                    var iframe = document.createElement('iframe');
                    iframe.style.visivility = 'hidden';
                    iframe.src = url;
                    documentbody.appendChild(iframe);
                    documentbody.removeChild(iframe);
                }
                return;
            }
        }
    </script>

    <script>
        (function () {
          const ANDROID_PACKAGE = "com.shinhan.sbanking";
          const PLAY = `https://play.google.com/store/apps/details?id=${ANDROID_PACKAGE}`;
          const INTENT = `intent://open#Intent;scheme=shinhansol;package=${ANDROID_PACKAGE};S.browser_fallback_url=${encodeURIComponent(PLAY)};end`;
          const DEEPLINK = "shinhansol://"; // 필요시 "shinhansol://transfer" 로 교체
        
          const isAndroid = /Android/i.test(navigator.userAgent);
          const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        
          function openAndroid({ withFallback = true } = {}) {
            const start = Date.now();
            let hidden = false;
            let fallbackTimer;
        
            const cancelFallback = () => {
              hidden = true;             // 앱으로 전환되면 hidden=true
              if (fallbackTimer) clearTimeout(fallbackTimer);
              removeGuards();
            };
        
            const removeGuards = () => {
              document.removeEventListener("visibilitychange", onVisibility);
              window.removeEventListener("pagehide", cancelFallback);
              window.removeEventListener("blur", cancelFallback);
            };
        
            const onVisibility = () => {
              if (document.visibilityState === "hidden") cancelFallback();
            };
        
            document.addEventListener("visibilitychange", onVisibility);
            window.addEventListener("pagehide", cancelFallback);
            window.addEventListener("blur", cancelFallback);
        
            // 1) Android에선 intent를 먼저 시도 (Chrome 권장)
            location.href = INTENT;
        
            if (!withFallback) {
              // 폴백 비활성: 앱 없으면 그냥 아무 변화 없게
              setTimeout(removeGuards, 2000);
              return;
            }
        
            // 2) 폴백: 여전히 페이지가 보이고(=앱 전환 실패), 시간이 많이 안 지났을 때만 스토어로
            fallbackTimer = setTimeout(() => {
              const elapsed = Date.now() - start;
              const stillVisible = document.visibilityState === "visible";
              if (!hidden && stillVisible && elapsed < 1800) location.href = PLAY;
              removeGuards();
            }, 1200);
          }
        
          function openIOS({ withFallback = true } = {}) {
            const start = Date.now();
            let fallbackTimer;
        
            const cancel = () => {
              if (fallbackTimer) clearTimeout(fallbackTimer);
              document.removeEventListener("visibilitychange", onVisibility);
              window.removeEventListener("pagehide", cancel);
              window.removeEventListener("blur", cancel);
            };
            const onVisibility = () => {
              if (document.visibilityState === "hidden") cancel();
            };
            document.addEventListener("visibilitychange", onVisibility);
            window.addEventListener("pagehide", cancel);
            window.addEventListener("blur", cancel);
        
            // 1) 딥링크
            location.href = DEEPLINK;
        
            if (!withFallback) {
              setTimeout(cancel, 2000);
              return;
            }
        
            // 2) 폴백
            fallbackTimer = setTimeout(() => {
              const elapsed = Date.now() - start;
              const stillVisible = document.visibilityState === "visible";
              if (stillVisible && elapsed < 1800) {
                location.href = "https://apps.apple.com/kr/app/id357484932"; // 신한 SOL뱅크
              }
              cancel();
            }, 1500);
          }
        
          document.getElementById("open-sol-btn").addEventListener("click", () => {
            if (isAndroid) return openAndroid({ withFallback: true });
            if (isIOS) return openIOS({ withFallback: true });
            alert("모바일 기기에서 열어주세요.");
          });
        })();
    </script>
    
    <p style="margin-top: 2em; color: gray;">※ 모바일에서만 작동합니다. 앱이 설치되어 있어야 합니다.</p>
</body>
</html>
