<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>송금 안내</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 2em; }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 10px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h2>송금하실 은행을 선택하세요</h2>

    <a href="shinhan-sbank://" class="btn">신한은행으로 송금하기</a><br>
    <button id="open-sol-btn">신한 SOL 실행하기</button><br>
    <a href="#" onclick="appLink(); return false;"  class="btn">국민은행으로 송금하기</a><br>
    <a href="toss://send?accountNo=12345678901234&bankCode=88" class="btn">토스로 송금하기</a>

    <script>
        function appLink() {
            var locIOS     = "kbbank://call?";
            var locAndroid = "intent://call?#Intent;scheme=kbbank;action=android.intent.action.VIEW;category=android.intent.category.BROWSABLE;package=com.kbstar.kbbank;end";
            var userAgent  = navigator.userAgent.toLowerCase();
        
            var delfinoYn = /Delfino-/i;
        
            if (userAgent.match(/iphone/) && !userAgent.match(delfinoYn)) {
                setTimeout(function() {
                    location.href = "https://itunes.apple.com/kr/app/kbseutabaengking/id373742138?mt=8";
                }, 1500);
                location.href = locIOS;
                return;
            } else if (userAgent.match(/android/) && !userAgent.match(delfinoYn)) {
                var androidStoreUrl = "https://play.google.com/store/apps/details?id=com.kbstar.kbbank";
        
                if (userAgent.match(/chrome/)) {
                    location.href = locAndroid;
                } else {
                    setTimeout(function() {
                        location.href = androidStoreUrl;
                    }, 1500);
        
                    var iframe = document.createElement('iframe');
                    iframe.style.visivility = 'hidden';
                    iframe.src = url;
                    documentbody.appendChild(iframe);
                    documentbody.removeChild(iframe);
                }
                return;
            }
        }
    </script>

    <script>
      (function () {
        const ANDROID_PACKAGE = "com.shinhan.sbanking";
        const PLAY = `https://play.google.com/store/apps/details?id=${ANDROID_PACKAGE}`;
        const IOS_STORE = "https://apps.apple.com/kr/app/id357484932"; // 신한SOL(개인)
        const DEEPLINK = "shinhansol://"; // 필요시 shinhansol://transfer 테스트
    
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isMobile = isAndroid || isIOS;
    
        function openAndroid() {
          const intentUrl = `intent://open#Intent;scheme=shinhansol;package=${ANDROID_PACKAGE};S.browser_fallback_url=${encodeURIComponent(PLAY)};end`;
          const start = Date.now();
    
          const toStore = () => { if (Date.now() - start < 1800) location.href = PLAY; };
    
          // 페이지 가시성으로 “앱 전환 성공” 감지 → 성공 시 폴백 중단
          const onVisibility = () => {
            document.removeEventListener("visibilitychange", onVisibility);
            // 보통 앱 전환되면 hidden으로 바뀜
          };
          document.addEventListener("visibilitychange", onVisibility);
    
          // 1) 딥링크 먼저
          location.href = DEEPLINK;
    
          // 2) 잠시 후에도 전환 없으면 intent로 재시도 → 그래도 실패하면 스토어
          setTimeout(() => {
            try { location.href = intentUrl; } catch(e) { toStore(); }
          }, 700);
    
          // 3) 최종 폴백
          setTimeout(toStore, 1600);
        }
    
        function openIOS() {
          const start = Date.now();
    
          const onVisibility = () => {
            // 앱으로 전환되면 보통 페이지가 background 처리됨
            document.removeEventListener("visibilitychange", onVisibility);
          };
          document.addEventListener("visibilitychange", onVisibility);
    
          // 1) 딥링크
          location.href = DEEPLINK;
    
          // 2) 전환 없으면 App Store
          setTimeout(() => {
            if (Date.now() - start < 1800) location.href = IOS_STORE;
          }, 1500);
        }
    
        document.getElementById("open-sol-btn").addEventListener("click", function () {
          if (!isMobile) return alert("모바일 기기에서 열어주세요.");
          if (isAndroid) return openAndroid();
          if (isIOS) return openIOS();
          location.href = DEEPLINK;
        });
      })();
    </script>
    
    <p style="margin-top: 2em; color: gray;">※ 모바일에서만 작동합니다. 앱이 설치되어 있어야 합니다.</p>
</body>
</html>
